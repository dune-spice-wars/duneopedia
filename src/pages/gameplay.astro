---
import { Image } from "astro:assets";
import gameplayBanner from "../assets/banners/gameplayBanner.png";
import Layout from "../layouts/Layout.astro";
import { operations, assassinationOperations } from "../data/gameplay";
import type { FactionId, Cost } from "../data/types";

const FACTION_NAMES: Record<FactionId, string> = {
	atreides: 'Atreides',
	harkonnen: 'Harkonnen',
	smugglers: 'Smugglers',
	fremen: 'Fremen',
	corrino: 'Corrino',
	ecaz: 'Ecaz',
	vernius: 'Vernius',
};

function formatCost(cost: Cost): string {
	const parts: string[] = [];
	if (cost.intel !== undefined) parts.push(`${cost.intel.toLocaleString()} Intel`);
	if (cost.solari !== undefined) parts.push(`${cost.solari.toLocaleString()} Solari`);
	if (cost.spice !== undefined) parts.push(`${cost.spice.toLocaleString()} Spice`);
	if (cost.water !== undefined) parts.push(`${cost.water.toLocaleString()} Water`);
	if (cost.manpower !== undefined) parts.push(`${cost.manpower.toLocaleString()} Manpower`);
	if (cost.authority !== undefined) parts.push(`${cost.authority.toLocaleString()} Authority`);
	return parts.join(' | ');
}

const commonOps = operations.filter(op => op.faction === 'all');
const factionOps = operations.filter(op => op.faction !== 'all');
---

<Layout
	title="Gameplay"
	description="Content for the various Gameplay elements in Dune: Spice Wars. This includes information about Victory Conditions, Espionage, Landsraad, Points of Interest | Duneopedia"
>
	<!-- Content -->
	<section>
		<header class="main">
			<h1>Gameplay</h1>
		</header>
		<span class="image main"
			><Image src={gameplayBanner} alt="Gameplay Banner" /></span
		>

		<blockquote>
			"I must not fear. Fear is the mind-killer. Fear is the little-death that
			brings total obliteration. I will face my fear. I will permit it to pass
			over me and through me. And when it has gone past I will turn the inner
			eye to see its path. Where the fear has gone there will be nothing. Only I
			will remain."
		</blockquote>

		<!-- LIST OF CONTENTS -->
		<h4 id="top">List of Contents</h4>
		<div id="contents" class="row">
			<div class="col-6 col-12-medium">
				<ul>
					<a href="#victory"
						><li><strong>1.0 | Victory Conditions</strong></li></a
					>
					<ul>
						<a href="#domination"><li>1.1 | Domination</li></a>
						<a href="#hegemony"><li>1.2 | Hegemony</li></a>
						<a href="#political"><li>1.3 | Political</li></a>
						<a href="#economical"><li>1.4 | Economical</li></a>
					</ul>
					<a href="#espionage"><li><strong>2.0 | Espionage</strong></li></a>
					<ul>
						<a href="#agents"><li>2.1 | Agents</li></a>
						<a href="#assignments"><li>2.2 | Assignments</li></a>
						<a href="#operations"><li>2.3 | Operations</li></a>
						<a href="#assassinations"><li>2.4 | Assassination Operations</li></a
						>
					</ul>
					<a href="#landsraad"
						><li><strong>3.0 | Landsraad Council</strong></li></a
					>
					<ul>
						<a href="#resolutions"><li>3.1 | Resolutions</li></a>
						<a href="#charters"><li>3.2 | Charters</li></a>
					</ul>
				</ul>
			</div>
			<div class="col-6 col-12-medium">
				<ul>
					<a href="#specialEvents"
						><li><strong>4.0 | Special Events</strong></li></a
					>
					<ul>
						<a href="#eventInfo"><li>4.1 | General Info</li></a>
						<a href="#allEvents"><li>4.2 | Event List</li></a>
					</ul>
					<a href="#POI"><li><strong>5.0 | Points of Interest</strong></li></a>
					<ul>
						<a href="#generalPOI"><li>5.1 | General Info</li></a>
						<a href="#allPOI"><li>5.2 | Points of Interest List</li></a>
					</ul>
				</ul>
			</div>
		</div>
		<!-- END LIST OF CONTENTS -->

		<!-- VICTORY INFO -->
		<header id="header"></header>
		<h2 id="victory">Victory Conditions</h2>
		<h3 id="domination">Domination</h3>
		<p>
			Achieve a Domination victory by eliminating all opposing Factions, either
			by destroying their Main Base or through Assassination.
		</p>

		<h3 id="political">Political</h3>
		<p>
			Achieve a Political victory by being elected to the Governor of Dune
			Charter for 45 days.
		</p>

		<h3 id="hegemony">Hegemony</h3>
		<p>Achieve a Hegemony victory by reaching 30,000 Hegemony.</p>

		<h3 id="economical">Economical</h3>
		<p>Achieve an Economical victory by holding 50% of CHOAM Shares.</p>
		<!-- END VICTORY -->

		<!-- ESPIONAGE -->
		<header id="header"></header>
		<h2 id="espionage">Espionage</h2>
		<h3 id="agents">Agents</h3>
		<ul>
			<li>
				Your first agent begins recruiting after capturing your first village
				and takes 10 days by default; each subsequent agent recruits
				progressively slower.
			</li>
			<li>
				Default max is <strong>10 agents</strong>, upgradeable to <strong
					>15</strong
				> via the Spying Mastery development.
			</li>
			<li>
				Captured agents can be traded back from the enemy faction, and also have
				a chance to escape on their own each day.
			</li>
			<li>
				Agent trait bonuses (recruitment speed, resource production, etc.) apply
				regardless of where the agent is assigned.
			</li>
		</ul>

		<p>
			Each agent will have 1 special trait that modifies their abilities
			according to the below table:
		</p>
		<div class="table-wrapper">
			<table>
				<thead>
					<tr>
						<th>Trait</th>
						<th>Effect</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Artist</td>
						<td>+1 Hegemony production</td>
					</tr>
					<tr>
						<td>Bene Gesserit</td>
						<td>Counts as 2 agents for Intelligence Levels</td>
					</tr>
					<tr>
						<td>Brainwashed</td>
						<td>−10% of every resource production</td>
					</tr>
					<tr>
						<td>Charismatic</td>
						<td
							><a class="link" target="_blank" href="arrakis.html#influence"
								>Influence</a
							> global production is increased by 2% per Information level</td
						>
					</tr>
					<tr>
						<td>Council Agent</td>
						<td
							>+100% Agent recruitment speed; cannot be captured; does not count
							toward agent limit</td
						>
					</tr>
					<tr>
						<td>Engineer</td>
						<td
							><a class="link" target="_blank" href="arrakis.html#plascrete"
								>Plascrete</a
							> global production is increased by 2% per Information level</td
						>
					</tr>
					<tr>
						<td>Fremen Sibling</td>
						<td
							>+5% <a class="link" target="_blank" href="arrakis.html#intel"
								>Intel</a
							> production; cannot be captured; does not count toward agent limit</td
						>
					</tr>
					<tr>
						<td>Ghost</td>
						<td
							>+50% <a class="link" target="_blank" href="arrakis.html#intel"
								>Intel</a
							> production</td
						>
					</tr>
					<tr>
						<td>Intendant</td>
						<td>+20% field resource production</td>
					</tr>
					<tr>
						<td>Mentat</td>
						<td>+50% field resource production</td>
					</tr>
					<tr>
						<td>Merchant</td>
						<td
							><a class="link" target="_blank" href="arrakis.html#solari"
								>Solari</a
							> global production is increased by 0.5% per Information level</td
						>
					</tr>
					<tr>
						<td>Psychologist</td>
						<td
							>+20% <a class="link" target="_blank" href="arrakis.html#intel"
								>Intel</a
							> production</td
						>
					</tr>
					<tr>
						<td>Recruiter</td>
						<td>+20% Agent recruitment speed</td>
					</tr>
					<tr>
						<td>Suk Doctor</td>
						<td
							><a class="link" target="_blank" href="arrakis.html#knowledge"
								>Knowledge</a
							> global production is increased by 5% per Information level</td
						>
					</tr>
				</tbody>
			</table>
		</div>

		<h3 id="assignments">Assignments</h3>
		<p>
			Up to <strong>3 agents</strong> can be assigned per spying field (Harkonnen
			faction gets +1 slot).
		</p>
		<p>
			Agents can be assigned to one of the following assignments to grant you
			benefits according to the below table:
		</p>
		<div class="table-wrapper">
			<table>
				<thead>
					<tr>
						<th>Assignment</th>
						<th>Effect</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Enemy Faction</td>
						<td>+3 <a class="link" target="_blank" href="arrakis.html#intel">Intel</a></td>
					</tr>
					<tr>
						<td>Arrakis</td>
						<td>+1 <a class="link" target="_blank" href="arrakis.html#authority">Authority</a></td>
					</tr>
					<tr>
						<td>Spacing Guild</td>
						<td>+1 <a class="link" target="_blank" href="arrakis.html#manpower">Manpower</a></td>
					</tr>
					<tr>
						<td>CHOAM</td>
						<td>+10 <a class="link" target="_blank" href="arrakis.html#solari">Solari</a></td>
					</tr>
					<tr>
						<td>Landsraad</td>
						<td>+1 <a class="link" target="_blank" href="arrakis.html#influence">Influence</a></td>
					</tr>
					<tr>
						<td>Counterintelligence</td>
						<td>
							<li>
								+1% daily chance to capture an enemy agent assigned on your
								faction
							</li>
							<li>10% chance to detect an operation targeting you</li>
							<li>
								10% chance to capture an agent when an operation against you has
								been detected
							</li>
							<li>Slows assassination preparation against you</li>
							<li>Does not generate any resources</li>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<h4 id="intel-levels">Intelligence Levels</h4>
		<p>
			Assigning agents to a faction's spying field raises your Intelligence
			Level with that faction, unlocking progressively more information and
			capabilities:
		</p>
		<ul>
			<li>
				<strong>Level 1</strong> — Reveals borders, village productions, councilors,
				and development counts; unlocks the Infiltration Cells operation.
			</li>
			<li>
				<strong>Level 2</strong> — Reveals main base buildings, command points, units,
				agent assignments, available operations, and Underworld HQ presence.
			</li>
			<li><strong>Level 3</strong> — Unlocks the Assassination operation.</li>
		</ul>

		<h3 id="operations">Operations</h3>
		<p>Operations are missions that can be launched by your Spies.</p>
		<p>
			Operations take <strong>3 days</strong> to prepare before deploying. Launching
			an operation exposes agents assigned to its prerequisite fields to capture risk
			— temporarily reassigning those agents before launching (and reassigning them
			back after) mitigates this risk.
		</p>
		<p>
			Each operation has a difficulty level that determines several factors
			according to the table below:
		</p>
		<div class="table-wrapper">
			<table>
				<thead>
					<tr>
						<th>Difficulty</th>
						<th>Effect</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Easy</td>
						<td
							><li>0% chance of complications each day</li>
							<li>
								30% chance of operation detection by the targeted enemy faction
							</li>
							<li>
								0% chance of agent capture when the operation is detected
							</li></td
						>
					</tr>
					<tr>
						<td>Medium</td>
						<td
							><li>5% chance of complications each day</li>
							<li>
								30% chance of operation detection by the targeted enemy faction
							</li>
							<li>
								20% chance of agent capture when the operation is detected
							</li></td
						>
					</tr>
					<tr>
						<td>Hard</td>
						<td
							><li>10% chance of complications each day</li>
							<li>
								30% chance of operation detection by the targeted enemy faction
							</li>
							<li>
								40% chance of agent capture when the operation is detected
							</li></td
						>
					</tr>
					<tr>
						<td>Epic</td>
						<td
							><li>15% chance of complications each day</li>
							<li>
								30% chance of operation detection by the targeted enemy faction
							</li>
							<li>
								60% chance of agent capture when the operation is detected
							</li></td
						>
					</tr>
					<tr>
						<td>Special</td>
						<td
							><li>0% chance of complications each day</li>
							<li>
								0% chance of operation detection by the targeted enemy faction
							</li></td
						>
					</tr>
				</tbody>
			</table>
		</div>

		<h3 id="operations-list"><strong>List of Operations</strong></h3>

		<h4>Common Operations (All Factions)</h4>
		{commonOps.map(op => (
			<h5 id={op.id}>{op.name}</h5>
			<ul>
				<li><strong>Cost</strong>: {formatCost(op.cost)} | <strong>Difficulty</strong>: {op.difficulty}</li>
				<li><strong>Information Levels Required</strong>: {op.infoLevelsRequired.length === 0 ? 'None' : op.infoLevelsRequired.join(' | ')}</li>
				<li><strong>Factions</strong>: All</li>
			</ul>
			<ul>
				{op.effects.map(effect => <li>{effect}</li>)}
			</ul>
		))}

		<h4>Faction-Specific Operations</h4>
		{factionOps.map(op => (
			<h5 id={op.id}>{op.name} (<a class="link" target="_blank" href={`${op.faction}.html`}>{FACTION_NAMES[op.faction as FactionId]}</a>)</h5>
			<ul>
				<li><strong>Cost</strong>: {formatCost(op.cost)} | <strong>Difficulty</strong>: {op.difficulty}</li>
				<li><strong>Information Levels Required</strong>: {op.infoLevelsRequired.length === 0 ? 'None' : op.infoLevelsRequired.join(' | ')}</li>
			</ul>
			<ul>
				{op.effects.map(effect => <li>{effect}</li>)}
			</ul>
		))}

		<h3 id="assassinations">Assassination Operations</h3>
		<p>Assassination operations are a special chain of missions leading to the elimination of a rival faction leader. They can be run concurrently with other operations.</p>
		{assassinationOperations.map(op => (
			<h5 id={op.id}>{op.name}</h5>
			<ul>
				<li><strong>Cost</strong>: {formatCost(op.cost)} | <strong>Difficulty</strong>: {op.difficulty}</li>
				<li><strong>Information Levels Required</strong>: {op.infoLevelsRequired.length === 0 ? 'None' : op.infoLevelsRequired.join(' | ')}</li>
				<li><strong>Factions</strong>: All</li>
			</ul>
			<ul>
				{op.effects.map(effect => <li>{effect}</li>)}
			</ul>
		))}

		<!-- END ESPIONAGE -->

		<!-- LANDSRAAD COUNCIL -->
		<header id="header"></header>
		<h2 id="landsraad">Landsraad Council</h2>
		<h3 id="resolutions">Resolutions</h3>
		**TO DO**

		<h3 id="charters">Charters</h3>
		**TO DO**
		<!-- END LANDSRAAD COUNCIL -->

		<!-- SPECIAL EVENTS -->
		<header id="header"></header>
		<h2 id="specialEvents">Special Events</h2>
		<h3 id="eventInfo">General Info</h3>
		**TO DO**

		<h3 id="allEvents">Event List</h3>
		**TO DO**
		<!-- END SPECIAL EVENTS -->

		<!-- POINTS OF INTEREST -->
		<header id="header"></header>
		<h2 id="POI">Points of Interest</h2>
		<h3 id="generalPOI">General Info</h3>
		**TO DO**

		<h3 id="allPOI">Points of Interest List</h3>
		**TO DO**
	</section>
</Layout>
